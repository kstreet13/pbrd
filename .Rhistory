# plot(c(1,ncol(clusMat)), 0:1, col='white')
# points(within, col=4)
# points(between, col=2)
# abline(v = which.max(within - between))
# points(sil, col=3)
# points(locAg, col = 5)
# choose the winner
clus <- factor(clusMat[,which.max(within - between + locAg + sil)])
table(clus, sce$Sample)
# umap plot colored by cluster
sce$clus <- clus
# barplots showing breakdown of each cluster by sample
# table(clus, sce$Sample)
# save it, so I don't have to keep re-running all this
saveRDS(sce, file='data/sce.rds')
# co-clustering matrix
#png(filename = '~/Desktop/coclus.png', width = 1000, height = 1000)
image(big[h$order,h$order])
?heatmap
table(sce$clus)
plot(reducedDim(sce,'umap'),asp=1, col=colorby(sce$clus), pch=16, main='UMAP - pbrd_1 and prd_1')
# with cluster labels on top
pal <- colorby(factor(1:lenu(sce$clus)))
centers <- t(sapply(levels(sce$clus), function(clID){
colMeans(reducedDim(sce,'umap')[which(sce$clus==clID),])
}))
legend('topright', legend=levels(sce$clus), pch=16, col=pal, bty='n')
points(centers,pch=1,cex=2.5)
points(centers,pch=16,cex=2.5, col=1)
text(centers, labels = levels(sce$clus), col = pal, font=2)
sce <- readRDS('data/sce.rds')
# want full dataset, in case marker genes not included in top 5000
require(DropletUtils)
sceFull <- read10xCounts(c('data/PRD_wk1_filtered_feature_bc_matrix','data/PBRD_wk1_filtered_feature_bc_matrix'),
sample.names = c('prd_1','pbrd_1'))
genes <- read.table('data/m33_gencode_Ens110_annotation.csv', sep = '\t', header = TRUE)
require(dplyr)
rowData(sceFull) <- left_join(as.data.frame(rowData(sceFull)), genes, join_by(ID == EnsemblID))
rm(genes)
sceFull$nUMI <- colSums(assay(sceFull,'counts'))
sceFull$nGene <- colSums(assay(sceFull,'counts') > 0)
norm <- log1p(1e4*t(t(assay(sceFull,'counts')) / sceFull$nUMI))
assay(sceFull,'logcounts') <- norm
rm(norm)
table(sce$clus)
upgenes <- sapply(unique(sce$clus), function(clID){
idx <- which(sce$clus == clID)
m1 <- rowMeans(assay(sce,'logcounts')[,idx])
m2 <- rowMeans(assay(sce,'logcounts')[,-idx])
return(which.max(m1-m2))
})
upgenes <- unique(upgenes)
markers <- c("CD34", "PECAM1", "CDH5",
"GJA4", "HEY1", "MECOM", "SOX17", "JAG1",
"EFNB2", "ACKR1", "ICAM1", "LRG1", "SELP",
"PROX1", "LYVE1", "PDPN", "NR2F2",
"SCA1", "KIT", "SLAMF1",
"EGFP_bGHpA", "ThreePrimeTdTomato")
markers <- sapply(markers, function(m){
grep(paste0('^', m, '$'), rowData(sceFull)$Symbol, ignore.case = TRUE)
})
markers <- do.call(c, markers)
markers <- unique(markers)
markers <- markers[! markers %in% upgenes] # give priority to the unsupervised method
genes <- c(upgenes, markers)
genecol <- c(rep(4,length(upgenes)), rep(6,length(markers)-2), 3, 2)
genes
means <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean(assay(sceFull,'logcounts')[gID, which(sce$clus == clID)])
})
})
rownames(means) <- rowData(sce)$Symbol[genes]
pcts <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean((assay(sce,'logcounts')[gID, which(sce$clus == clID)] > 0))
})
})
pcts <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean((assay(sceFull,'logcounts')[gID, which(sce$clus == clID)] > 0))
})
})
upgenes
upgenes <- sapply(unique(sce$clus), function(clID){
idx <- which(sce$clus == clID)
m1 <- rowMeans(assay(sce,'logcounts')[,idx])
m2 <- rowMeans(assay(sce,'logcounts')[,-idx])
return(which.max(m1-m2))
})
upgenes <- unique(rownames(sce)[upgenes])
upgenes
markers <- c("CD34", "PECAM1", "CDH5",
"GJA4", "HEY1", "MECOM", "SOX17", "JAG1",
"EFNB2", "ACKR1", "ICAM1", "LRG1", "SELP",
"PROX1", "LYVE1", "PDPN", "NR2F2",
"SCA1", "KIT", "SLAMF1",
"EGFP_bGHpA", "ThreePrimeTdTomato")
markers <- sapply(markers, function(m){
grep(paste0('^', m, '$'), rowData(sceFull)$Symbol, ignore.case = TRUE)
})
markers <- do.call(c, markers)
markers <- unique(rownames(sceFull)[markers])
markers <- markers[! markers %in% upgenes] # give priority to the unsupervised method
#
markers
genes <- c(upgenes, markers)
genes
genes <- match(c(upgenes, markers), rownames(sceFull))
upgenes
markers
genes
length(genes)
length(upgenes)
length(markers)
genecol <- c(rep(4,length(upgenes)), rep(6,length(markers)-2), 3, 2)
genecol
length(genecol)
means <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean(assay(sceFull,'logcounts')[gID, which(sce$clus == clID)])
})
})
rownames(means) <- rowData(sce)$Symbol[genes]
pcts <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean((assay(sceFull,'logcounts')[gID, which(sce$clus == clID)] > 0))
})
})
rownames(pcts) <- rowData(sce)$Symbol[genes]
means
rownames(means) <- rowData(sceFull)$Symbol[genes]
pcts
rownames(pcts) <- rowData(sceFull)$Symbol[genes]
pcts
hc.genes <- hclust(dist(means))
hc.clus <- hclust(dist(t(means)))
means <- means[hc.genes$order, hc.clus$order]
pcts <- pcts[hc.genes$order, hc.clus$order]
genecol <- genecol[hc.genes$order]
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.7)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
plot(c(1,ncol(clusMat)), 0:1, col='white')
points(within, col=4)
points(between, col=2)
abline(v = which.max(within - between + locAg + sil))
points(sil, col=3)
points(locAg, col = 5)
png(filename = '~/Desktop/cluster_by_samp.png', width = 1000, height = 1000)
layout(matrix(1:24, ncol=4))
par(mar=c(3,3,3,1))
for(i in 1:22){
barplot(table(sce$clus, sce$Sample)[i,], col=pal[i],
main=paste('Cluster',i),
ylim = c(0,max(table(sce$clus,sce$Sample))))
}
?DimPlot
?Ident
?ident
?Idents
?DimPlot
sce
table(sce$clus)
png(filename = '~/Desktop/cluster_by_samp.png', width = 1000, height = 1000)
layout(matrix(1:24, ncol=4))
par(mar=c(3,3,3,1))
for(i in 1:22){
barplot(table(sce$clus, sce$Sample)[i,], col=pal[i],
main=paste('Cluster',i),
ylim = c(0,max(table(sce$clus,sce$Sample))))
}
length(unique(sce$clus))
png(filename = '~/Desktop/cluster_by_samp.png', width = 1000, height = 1000)
layout(matrix(1:20, ncol=4))
par(mar=c(3,3,3,1))
for(i in 1:length(unique(sce$clus))){
barplot(table(sce$clus, sce$Sample)[i,], col=pal[i],
main=paste('Cluster',i),
ylim = c(0,max(table(sce$clus,sce$Sample))))
}
dev.off()
layout(1)
par(mar=c(5,4,4,2)+.1)
2014-1962
2024-1962
?Seurat::ScaleData
?RunPCA
?Seurat::RunPCA
require(Seurat)
?FindVariableFeatures
?ScaleData
?RunTFIDF
??RunTFIDF
sce <- readRDS('data/sce.rds')
# umap plot, colored by cluster
# png(filename = '~/Desktop/umap.png', width = 1000, height = 1000, res=100)
plot(reducedDim(sce,'umap'),asp=1, col=colorby(sce$clus), pch=16, main='UMAP - pbrd_1 and prd_1')
source('setup_2.R')
set.seed(1)
seu <- as.Seurat(sce)
seu <- FindNeighbors(seu, reduction = "mnn", dims = 1:25)
params <- data.frame(
alg = rep(2:4, each=6),
res = rep(c(.5,.6,.7,.8,.9,1), times=3)
)
clusMat <- sapply(1:nrow(params), function(i){
seu <- FindClusters(seu, algorithm = params$alg[i], resolution = params$res[i])
return(as.numeric(seu$seurat_clusters))
})
for(k in 4:10){
km <- kmeans(reducedDim(sce,'mnn')[,1:25], centers = k)
clusMat <- cbind(clusMat, km$cluster)
}
rm(km)
hc <- hclust(dist(reducedDim(sce,'mnn')[,1:25]))
for(k in 4:10){
clusMat <- cbind(clusMat, cutree(hc, k = k))
}
rm(hc)
big <- apply(clusMat,1,function(x){
apply(clusMat,1,function(y){
mean(x==y)
})
})
h <- hclust(as.dist(1-big))
# which clustering is most consistent with overall agreement?
diag(big) <- NA
within <- apply(clusMat,2,function(cl){
means <- sapply(unique(cl), function(clID){
idx <- which(cl == clID)
return(c(mean(big[idx,idx], na.rm=TRUE), length(idx)))
})
return(sum(means[1,]*means[2,]) / length(cl))
})
between <- apply(clusMat,2,function(cl){
means <- sapply(unique(cl), function(clID){
idx <- which(cl == clID)
return(c(mean(big[idx,-idx], na.rm=TRUE), length(idx)))
})
return(sum(means[1,]*means[2,]) / length(cl))
})
diag(big) <- 1
require(cluster)
d.all <- dist(reducedDim(sce,'mnn')[,1:25])
sil <- apply(clusMat,2,function(cl){
s <- silhouette(as.integer(cl), d.all)
return(mean(s[,'sil_width']))
})
rm(d.all)
require(dbscan)
nn <- kNN(reducedDim(sce,'mnn')[,1:25], k = 20)$id
locAg <- apply(clusMat,2,function(cl){
nnClus <- matrix(cl[nn], ncol=20)
return(mean(cl == nnClus))
})
rm(nn)
# plot(c(1,ncol(clusMat)), 0:1, col='white')
# points(within, col=4)
# points(between, col=2)
# abline(v = which.max(within - between))
# points(sil, col=3)
# points(locAg, col = 5)
# choose the winner
clus <- factor(clusMat[,which.max(within - between + locAg + sil)])
table(clus, sce$Sample)
# umap plot colored by cluster
sce$clus <- clus
# umap plot, colored by cluster
# png(filename = '~/Desktop/umap.png', width = 1000, height = 1000, res=100)
plot(reducedDim(sce,'umap'),asp=1, col=colorby(sce$clus), pch=16, main='UMAP - pbrd_1 and prd_1')
# with cluster labels on top
pal <- colorby(factor(1:lenu(sce$clus)))
centers <- t(sapply(levels(sce$clus), function(clID){
colMeans(reducedDim(sce,'umap')[which(sce$clus==clID),])
}))
legend('topright', legend=levels(sce$clus), pch=16, col=pal, bty='n')
points(centers,pch=1,cex=2.5)
points(centers,pch=16,cex=2.5, col=1)
text(centers, labels = levels(sce$clus), col = pal, font=2)
# dev.off()
sce <- readRDS('data/sce.rds')
# want full dataset, in case marker genes not included in top 5000
require(DropletUtils)
sceFull <- read10xCounts(c('data/PRD_wk1_filtered_feature_bc_matrix','data/PBRD_wk1_filtered_feature_bc_matrix'),
sample.names = c('prd_1','pbrd_1'))
genes <- read.table('data/m33_gencode_Ens110_annotation.csv', sep = '\t', header = TRUE)
require(dplyr)
rowData(sceFull) <- left_join(as.data.frame(rowData(sceFull)), genes, join_by(ID == EnsemblID))
rm(genes)
sceFull$nUMI <- colSums(assay(sceFull,'counts'))
sceFull$nGene <- colSums(assay(sceFull,'counts') > 0)
norm <- log1p(1e4*t(t(assay(sceFull,'counts')) / sceFull$nUMI))
assay(sceFull,'logcounts') <- norm
rm(norm)
upgenes <- sapply(unique(sce$clus), function(clID){
idx <- which(sce$clus == clID)
m1 <- rowMeans(assay(sce,'logcounts')[,idx])
m2 <- rowMeans(assay(sce,'logcounts')[,-idx])
return(which.max(m1-m2))
})
upgenes <- unique(rownames(sce)[upgenes])
markers <- c("CD34", "PECAM1", "CDH5",
"GJA4", "HEY1", "MECOM", "SOX17", "JAG1",
"EFNB2", "ACKR1", "ICAM1", "LRG1", "SELP",
"PROX1", "LYVE1", "PDPN", "NR2F2",
"SCA1", "KIT", "SLAMF1",
"EGFP_bGHpA", "ThreePrimeTdTomato")
markers <- sapply(markers, function(m){
grep(paste0('^', m, '$'), rowData(sceFull)$Symbol, ignore.case = TRUE)
})
markers <- do.call(c, markers)
markers <- unique(rownames(sceFull)[markers])
markers <- markers[! markers %in% upgenes] # give priority to the unsupervised method
#
genes <- match(c(upgenes, markers), rownames(sceFull))
genecol <- c(rep(4,length(upgenes)), rep(6,length(markers)-2), 3, 2)
#
means <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean(assay(sceFull,'logcounts')[gID, which(sce$clus == clID)])
})
})
rownames(means) <- rowData(sceFull)$Symbol[genes]
pcts <- sapply(unique(sce$clus), function(clID){
sapply(genes, function(gID){
mean((assay(sceFull,'logcounts')[gID, which(sce$clus == clID)] > 0))
})
})
rownames(pcts) <- rowData(sceFull)$Symbol[genes]
hc.genes <- hclust(dist(means))
hc.clus <- hclust(dist(t(means)))
means <- means[hc.genes$order, hc.clus$order]
pcts <- pcts[hc.genes$order, hc.clus$order]
genecol <- genecol[hc.genes$order]
#png(filename = '~/Desktop/dots.png', width = 1000, height = 1000, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.7)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
#dev.off()
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.5)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
#dev.off()
png(filename = '~/Desktop/dots.png', width = 1000, height = 1000, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.5)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/umap.png', width = 1000, height = 1000, res=100)
plot(reducedDim(sce,'umap'),asp=1, col=colorby(sce$clus), pch=16, main='UMAP - pbrd_1 and prd_1')
# with cluster labels on top
pal <- colorby(factor(1:lenu(sce$clus)))
centers <- t(sapply(levels(sce$clus), function(clID){
colMeans(reducedDim(sce,'umap')[which(sce$clus==clID),])
}))
legend('topright', legend=levels(sce$clus), pch=16, col=pal, bty='n')
points(centers,pch=1,cex=2.5)
points(centers,pch=16,cex=2.5, col=1)
text(centers, labels = levels(sce$clus), col = pal, font=2)
dev.off()
png(filename = '~/Desktop/cluster_by_samp.png', width = 1000, height = 1000)
layout(matrix(1:20, ncol=4))
par(mar=c(3,3,3,1))
for(i in 1:length(unique(sce$clus))){
barplot(table(sce$clus, sce$Sample)[i,], col=pal[i],
main=paste('Cluster',i),
ylim = c(0,max(table(sce$clus,sce$Sample))))
}
dev.off()
layout(1)
par(mar=c(5,4,4,2)+.1)
png(filename = '~/Desktop/dots.png', width = 800, height = 1200, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.5)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/dots.png', width = 800, height = 1500, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.5)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/dots.png', width = 800, height = 1500, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.6)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/dots.png', width = 800, height = 1500, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.7)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/dots.png', width = 800, height = 1500, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.8)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
png(filename = '~/Desktop/dots.png', width = 800, height = 1500, res=130)
plot(c(1,ncol(means)), c(1,nrow(means)), col='white', asp=1, axes=FALSE, xlab='Cluster', ylab='', main='Potential Marker Genes')
#abline(v = 1:ncol(means), col = 'lightgrey', lty = 2)
#abline(h = 1:nrow(means), col = 'lightgrey', lty = 2)
points(rep(1:ncol(means), each = nrow(means)),
rep(1:nrow(means), times = ncol(means)),
col = alpha(rep(genecol, times = ncol(means)), alpha=as.numeric(pcts)),
cex = 1.8*sqrt(as.numeric(means)),
pch = 16)
axis(1, at=1:ncol(means), labels = unique(sce$clus)[hc.clus$order], cex.axis=.7)
axis(2, at=1:nrow(means), labels = rownames(means), las=1, cex.axis=.6)
dev.off()
require(rhdf5)
h5ls('~/Downloads/Adata-object_All.h5')
install.packages('loomR')
BiocManager::install('zellkonverter')
require(zellkonverter)
?readH5AD
x <- readH5AD('~/Downloads/Adata-object_All.h5')
x
x <- readH5AD('~/Downloads/Adata-object_All.h5')
AnnDataDependencies()
readH5AD('~/Downloads/Adata-object_All.h5')
BiocManager::install('basilisk')
x <- readH5AD('~/Downloads/Adata-object_All.h5')
remove.packages('reticulate')
install.packages('reticulate')
install.packages("reticulate")
require(reticulate)
require(zellkonverter)
x <- readH5AD('~/Downloads/Adata-object_All.h5')
x
corner(assay(x,'X'))
corner(assay(x,'normalized'))
corner(assay(x,'zscore'))
corner(assay(x,'X'))
corner(assay(x,'zscore')) - corner(assay(x,'X'))
x
plot(assay(x,'normalized')[1,])
hist(assay(x,'normalized')[1,])
hist(assay(x,'normalized')[2,])
hist(assay(x,'normalized')[3,])
hist(assay(x,'normalized')[4,])
hist(assay(x,'normalized')[5,])
ref <- x
rm(x)
head(colData(ref))
x
ref
plot(reducedDim(ref,'X_umap'))
require(Seurat)
?RunPCA
